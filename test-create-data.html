<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Create Event and Forum Data</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 10px;
        }
        .success {
            color: #22c55e;
            font-weight: bold;
        }
        .error {
            color: #ef4444;
            font-weight: bold;
        }
        .info {
            color: #3b82f6;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f9fafb;
            border-left: 4px solid #2563eb;
            border-radius: 4px;
        }
        .step {
            margin: 10px 0;
            padding: 8px;
            background: #e0e7ff;
            border-radius: 4px;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #1d4ed8;
        }
        #console-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-success { color: #22c55e; }
        .log-error { color: #ef4444; }
        .log-warning { color: #eab308; }
        .log-info { color: #3b82f6; }
        .log-section { color: #06b6d4; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Script - Create Event and Forum Data</h1>
        
        <div class="section">
            <h2>üìã Instructions</h2>
            <p>This script will create:</p>
            <ul>
                <li>1 event for validation (pending approval)</li>
                <li>3 forum topics in different categories</li>
                <li>3 comments on forum topics</li>
            </ul>
            <p><strong>Important:</strong> Make sure you have your application open in another tab/window before running this script.</p>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button onclick="runTest()">‚ñ∂Ô∏è Run Test Script</button>
            <button onclick="clearData()" style="background: #ef4444;">üóëÔ∏è Clear Test Data</button>
            <button onclick="verifyData()" style="background: #22c55e;">‚úÖ Verify Data</button>
        </div>

        <div id="console-output"></div>
    </div>

    <script>
        const MOCK_DB_KEY = 'mockDatabase_condominio';
        const FORUM_STORAGE_KEY = 'forum_topics_ciudad_colonial';
        const output = document.getElementById('console-output');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log-${type}`;
            div.textContent = message;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            output.innerHTML = '';
        }

        const testUser = {
            id: 999,
            nombre: 'Usuario de Prueba',
            correo: 'test@ciudadcolonial.com',
        };

        function createEvent() {
            log('üìÖ Step 1: Creating an Event', 'section');
            
            try {
                const db = JSON.parse(localStorage.getItem(MOCK_DB_KEY) || '{"anuncios": []}');
                if (!db.anuncios) {
                    db.anuncios = [];
                }

                const newEvent = {
                    id: db.anuncios.length > 0 
                        ? Math.max(...db.anuncios.map((a) => a.id)) + 1 
                        : 1,
                    titulo: 'üéâ Fiesta de Bienvenida - Presentaci√≥n del Sistema',
                    contenido: `¬°Hola vecinos! 

Estamos organizando una fiesta de bienvenida para presentar el nuevo sistema de gesti√≥n comunitaria.

üìÖ Fecha: ${new Date().toLocaleDateString('es-ES', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    })}
üïê Hora: 6:00 PM
üìç Lugar: Sal√≥n de Eventos del Condominio

Actividades:
- Presentaci√≥n del sistema web
- Refrigerios
- M√∫sica en vivo
- Actividades para ni√±os

¬°Esperamos contar con tu presencia!

Este evento fue creado autom√°ticamente por el script de pruebas del sistema.`,
                    fecha: new Date().toISOString().split('T')[0],
                    categoria: 'evento',
                    autor: 'Pendiente de aprobaci√≥n',
                    estado: 'pendiente',
                    usuario_id: testUser.id,
                    usuario_nombre: testUser.nombre,
                };

                db.anuncios.push(newEvent);
                localStorage.setItem(MOCK_DB_KEY, JSON.stringify(db));

                log('‚úì Event created successfully!', 'success');
                log(`   Event ID: ${newEvent.id}`);
                log(`   Title: ${newEvent.titulo}`);
                log(`   Status: ${newEvent.estado}`);
                log(`   User: ${newEvent.usuario_nombre} (ID: ${newEvent.usuario_id})`);

                return { success: true, event: newEvent };
            } catch (error) {
                log(`‚úó Failed to create event: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }

        function createForumTopics() {
            log('üí¨ Step 2: Creating Forum Topics and Comments', 'section');
            
            try {
                const forumData = JSON.parse(localStorage.getItem(FORUM_STORAGE_KEY) || '{"topics": [], "comments": []}');
                if (!forumData.topics) forumData.topics = [];
                if (!forumData.comments) forumData.comments = [];

                const topics = [
                    {
                        id: forumData.topics.length > 0 
                            ? Math.max(...forumData.topics.map((t) => t.id)) + 1 
                            : 1,
                        categoryId: 'comunidad',
                        title: 'üéä Presentaci√≥n del Nuevo Sistema de Gesti√≥n',
                        content: `¬°Hola a todos los residentes de Ciudad Colonial!

Me complace anunciar que hemos implementado un nuevo sistema de gesti√≥n comunitaria que facilitar√° la comunicaci√≥n y administraci√≥n de nuestro condominio.

**Caracter√≠sticas principales:**
- üì¢ Anuncios y noticias en tiempo real
- üí¨ Foro comunitario para discusiones
- üìÖ Reserva de espacios comunes
- üîß Solicitudes de mantenimiento
- üí∞ Gesti√≥n de pagos
- üéâ Creaci√≥n y validaci√≥n de eventos

Este sistema ha sido probado y verificado para asegurar su correcto funcionamiento.

¬°Esperamos que todos lo disfruten!

Saludos,
Equipo de Administraci√≥n`,
                        author: testUser.nombre,
                        createdAt: new Date().toISOString(),
                    },
                    {
                        id: (forumData.topics.length > 0 
                            ? Math.max(...forumData.topics.map((t) => t.id)) + 1 
                            : 1) + 1,
                        categoryId: 'profesionales-disponibles',
                        title: 'üîß Servicios de Mantenimiento Disponibles',
                        content: `Buenos d√≠as vecinos,

Me presento: Soy ${testUser.nombre} y ofrezco servicios de mantenimiento y reparaciones para el condominio.

**Servicios que ofrezco:**
- Reparaci√≥n de electrodom√©sticos
- Plomer√≠a b√°sica
- Electricidad
- Pintura
- Carpinter√≠a menor

**Disponibilidad:**
- Lunes a Viernes: 8:00 AM - 6:00 PM
- S√°bados: 9:00 AM - 2:00 PM

**Contacto:**
- Email: ${testUser.correo}
- Disponible a trav√©s del sistema de mensajer√≠a

Precios competitivos y trabajo garantizado.

¬°Estoy aqu√≠ para ayudar a la comunidad!`,
                        author: testUser.nombre,
                        createdAt: new Date().toISOString(),
                    },
                    {
                        id: (forumData.topics.length > 0 
                            ? Math.max(...forumData.topics.map((t) => t.id)) + 1 
                            : 1) + 2,
                        categoryId: 'mantenimiento',
                        title: 'üí° Sugerencia: Mejoras en el Sistema de Iluminaci√≥n',
                        content: `Hola comunidad,

Quisiera proponer algunas mejoras en el sistema de iluminaci√≥n de las √°reas comunes:

1. **Iluminaci√≥n LED en pasillos:** Cambiar las bombillas actuales por LED para ahorro energ√©tico
2. **Sensores de movimiento:** Instalar sensores en √°reas poco transitadas
3. **Iluminaci√≥n exterior:** Mejorar la iluminaci√≥n del estacionamiento

Estas mejoras podr√≠an:
- Reducir costos de electricidad
- Mejorar la seguridad
- Ser m√°s amigables con el ambiente

¬øQu√© opinan? ¬øAlguien m√°s tiene sugerencias?

Saludos`,
                        author: testUser.nombre,
                        createdAt: new Date().toISOString(),
                    },
                ];

                forumData.topics.push(...topics);

                const comments = [
                    {
                        id: forumData.comments.length > 0 
                            ? Math.max(...forumData.comments.map((c) => c.id)) + 1 
                            : 1,
                        topicId: topics[0].id,
                        author: 'Administraci√≥n',
                        content: `¬°Excelente iniciativa! El sistema est√° dise√±ado para facilitar la comunicaci√≥n entre todos los residentes. Cualquier duda o sugerencia, no duden en contactarnos.`,
                        createdAt: new Date().toISOString(),
                    },
                    {
                        id: (forumData.comments.length > 0 
                            ? Math.max(...forumData.comments.map((c) => c.id)) + 1 
                            : 1) + 1,
                        topicId: topics[0].id,
                        author: 'Residente Ejemplo',
                        content: `Me parece genial. Ya prob√© algunas funciones y todo funciona muy bien. ¬°Felicitaciones al equipo!`,
                        createdAt: new Date().toISOString(),
                    },
                    {
                        id: (forumData.comments.length > 0 
                            ? Math.max(...forumData.comments.map((c) => c.id)) + 1 
                            : 1) + 2,
                        topicId: topics[2].id,
                        author: 'Vecino Responsable',
                        content: `Excelente propuesta. Estoy de acuerdo con todas las sugerencias. ¬øPodr√≠amos calcular el ahorro estimado?`,
                        createdAt: new Date().toISOString(),
                    },
                ];

                forumData.comments.push(...comments);
                localStorage.setItem(FORUM_STORAGE_KEY, JSON.stringify(forumData));

                log('‚úì Forum topics created successfully!', 'success');
                log(`   Topics created: ${topics.length}`);
                log(`   Comments created: ${comments.length}`);
                
                topics.forEach((topic, index) => {
                    log(`‚Üí Topic ${index + 1}: "${topic.title}" (Category: ${topic.categoryId})`, 'info');
                });

                return { success: true, topics, comments };
            } catch (error) {
                log(`‚úó Failed to create forum topics: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }

        function verifyEventInValidation() {
            log('‚úÖ Step 3: Verifying Event in Validation Page', 'section');
            
            try {
                const db = JSON.parse(localStorage.getItem(MOCK_DB_KEY) || '{"anuncios": []}');
                const eventos = (db.anuncios || []).filter(a => a.categoria === 'evento');
                const eventosPendientes = eventos.filter(e => e.estado === 'pendiente');

                log(`   Total events found: ${eventos.length}`);
                log(`   Pending events: ${eventosPendientes.length}`);

                if (eventosPendientes.length > 0) {
                    log('‚úì Events are available for validation!', 'success');
                    eventosPendientes.forEach((evento, index) => {
                        log(`‚Üí Event ${index + 1}: "${evento.titulo}"`, 'info');
                        log(`     - ID: ${evento.id}`);
                        log(`     - Status: ${evento.estado}`);
                        log(`     - Author: ${evento.usuario_nombre || evento.autor}`);
                    });
                    return { success: true, count: eventosPendientes.length, events: eventosPendientes };
                } else {
                    log('‚ö† No pending events found', 'warning');
                    return { success: false, message: 'No pending events' };
                }
            } catch (error) {
                log(`‚úó Failed to verify events: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }

        function verifyForumContent() {
            log('‚úÖ Step 4: Verifying Forum Content', 'section');
            
            try {
                const forumData = JSON.parse(localStorage.getItem(FORUM_STORAGE_KEY) || '{"topics": [], "comments": []}');
                const topics = forumData.topics || [];
                const comments = forumData.comments || [];

                log(`   Total topics found: ${topics.length}`);
                log(`   Total comments found: ${comments.length}`);

                if (topics.length > 0) {
                    log('‚úì Forum topics are available!', 'success');
                    
                    const topicsByCategory = {};
                    topics.forEach(topic => {
                        if (!topicsByCategory[topic.categoryId]) {
                            topicsByCategory[topic.categoryId] = [];
                        }
                        topicsByCategory[topic.categoryId].push(topic);
                    });

                    Object.keys(topicsByCategory).forEach(category => {
                        log(`‚Üí Category: ${category} (${topicsByCategory[category].length} topics)`, 'info');
                        topicsByCategory[category].forEach(topic => {
                            const commentCount = comments.filter(c => c.topicId === topic.id).length;
                            log(`     - "${topic.title}" (${commentCount} comments)`);
                        });
                    });

                    return { success: true, topics, comments };
                } else {
                    log('‚ö† No forum topics found', 'warning');
                    return { success: false, message: 'No forum topics' };
                }
            } catch (error) {
                log(`‚úó Failed to verify forum: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }

        function generateReport(results) {
            log('');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'section');
            log('           COMPREHENSIVE TEST REPORT', 'section');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'section');
            log('');

            if (results.event.success) {
                log('‚úì Event Creation: PASSED', 'success');
                log(`   Title: ${results.event.event.titulo}`);
                log(`   Status: ${results.event.event.estado}`);
                log(`   User: ${results.event.event.usuario_nombre}`);
            } else {
                log('‚úó Event Creation: FAILED', 'error');
            }

            if (results.forum.success) {
                log('‚úì Forum Creation: PASSED', 'success');
                log(`   Topics Created: ${results.forum.topics.length}`);
                log(`   Comments Created: ${results.forum.comments.length}`);
            } else {
                log('‚úó Forum Creation: FAILED', 'error');
            }

            if (results.eventVerification.success) {
                log('‚úì Event Verification: PASSED', 'success');
                log(`   Pending Events: ${results.eventVerification.count}`);
            } else {
                log('‚ö† Event Verification: WARNING', 'warning');
            }

            if (results.forumVerification.success) {
                log('‚úì Forum Verification: PASSED', 'success');
                log(`   Total Topics: ${results.forumVerification.topics.length}`);
                log(`   Total Comments: ${results.forumVerification.comments.length}`);
            } else {
                log('‚ö† Forum Verification: WARNING', 'warning');
            }

            log('');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'section');
            log('‚úì All features are ready for presentation!', 'success');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'section');
            log('');
            log('üìã Next Steps:', 'section');
            log('1. Go to Admin ‚Üí Validaci√≥n ‚Üí Events tab');
            log('2. Go to Forum (Libros page)');
            log('3. Test the validation flow');
            log('');
        }

        function runTest() {
            clearOutput();
            log('üöÄ Starting Test Script...', 'section');
            log('');

            const results = {
                event: createEvent(),
                forum: createForumTopics(),
                eventVerification: verifyEventInValidation(),
                forumVerification: verifyForumContent(),
            };

            generateReport(results);
        }

        function verifyData() {
            clearOutput();
            log('üîç Verifying Existing Data...', 'section');
            log('');

            const eventVerification = verifyEventInValidation();
            const forumVerification = verifyForumContent();

            log('');
            if (eventVerification.success && forumVerification.success) {
                log('‚úì All data is present and correct!', 'success');
            } else {
                log('‚ö† Some data may be missing. Run the test script first.', 'warning');
            }
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all test data? This will remove all events and forum topics created by the test script.')) {
                try {
                    const db = JSON.parse(localStorage.getItem(MOCK_DB_KEY) || '{"anuncios": []}');
                    if (db.anuncios) {
                        db.anuncios = db.anuncios.filter(a => !(a.categoria === 'evento' && a.usuario_id === 999));
                        localStorage.setItem(MOCK_DB_KEY, JSON.stringify(db));
                    }

                    const forumData = JSON.parse(localStorage.getItem(FORUM_STORAGE_KEY) || '{"topics": [], "comments": []}');
                    if (forumData.topics) {
                        forumData.topics = forumData.topics.filter(t => t.author !== testUser.nombre);
                    }
                    if (forumData.comments) {
                        const topicIds = forumData.topics.map(t => t.id);
                        forumData.comments = forumData.comments.filter(c => !topicIds.includes(c.topicId));
                    }
                    localStorage.setItem(FORUM_STORAGE_KEY, JSON.stringify(forumData));

                    clearOutput();
                    log('‚úì Test data cleared successfully!', 'success');
                } catch (error) {
                    clearOutput();
                    log(`‚úó Error clearing data: ${error.message}`, 'error');
                }
            }
        }

        // Auto-run on page load
        window.addEventListener('load', () => {
            log('üìÑ Test page loaded. Click "Run Test Script" to create test data.', 'info');
        });
    </script>
</body>
</html>




